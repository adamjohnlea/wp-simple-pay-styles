# WP Simple Pay Styles Developer Readme

**Plugin Name:** WP Simple Pay Styles
**Description:** Adds advanced styling capabilities to WP Simple Pay Pro/Lite forms, allowing per-form customization of both Stripe Elements and standard form fields.
**Version:** 1.0.0 (Development)
**Author:** Adam Lea (via AI Assistant)

## Purpose

This plugin extends WP Simple Pay (Pro and Lite versions) by providing a user interface within the WP Simple Pay form editor to customize the visual appearance of individual "On-Site" (Embedded/Overlay) payment forms. It aims to seamlessly integrate styling for both the secure Stripe Elements (Card, CVC, Expiry) and the standard HTML fields (Name, Email, Address, Custom Fields, Button) generated by WP Simple Pay.

## Requirements

*   WordPress 5.0 or later
*   PHP 7.4 or later
*   WP Simple Pay Pro **or** Lite version 4.7.0 or later (due to reliance on specific hooks and features introduced around this version, particularly the UPE/Elements Appearance API filter).

## Key Features

*   **Per-Form Styling:** Allows unique styles to be applied to individual WP Simple Pay forms.
*   **Integrated Admin UI:** Adds a "Form Styles" section directly into the WP Simple Pay form editor's "General" tab for a seamless user experience.
*   **Stripe Elements Customization:** Utilizes the `simpay_elements_config` filter to modify the configuration passed to the Stripe Elements Appearance API, allowing customization of elements like the card input fields.
*   **Custom Field Styling:** Generates and injects inline CSS to style standard WP Simple Pay fields (labels, text inputs, selects, buttons, etc.) that are not controlled by the Stripe Elements API.
*   **Preview Compatibility:** Styles are applied on both live published pages and the WP Simple Pay preview (`?simpay-preview=...`) pages.

## Technical Overview

### Style Storage

*   Custom style settings for each form are stored as individual post meta entries associated with the `simple-pay` custom post type.
*   Meta keys are prefixed with `_ajl_style_` (e.g., `_ajl_style_primary_color`, `_ajl_style_button_background_color`).
*   The `AJL_WP_Simple_Pay_Styles\AJL_Settings` class handles retrieving and saving these meta values.

### Admin UI

*   The styling options UI is added via the `simpay_form_settings_display_options_panel` action hook within the WP Simple Pay form editor.
*   The `AJL_WP_Simple_Pay_Styles\AJL_Admin_UI` class manages:
    *   Hooking into the WP Simple Pay settings panel.
    *   Rendering the style input fields (color pickers, number inputs, selects).
    *   Saving the settings via the `save_post_simple-pay` action hook.
    *   Enqueueing necessary admin scripts (like the WordPress color picker).
*   The UI is conditionally displayed only for forms where the `_form_display_type` meta field is `embedded` or `overlay`.

### Frontend Styling Application

The `AJL_WP_Simple_Pay_Styles\AJL_Frontend` class handles applying the saved styles on the frontend.

1.  **Stripe Elements Styling:**
    *   Hooks into the `simpay_elements_config` filter unconditionally.
    *   Uses the `simpay_form_before_form_top` action hook to capture the IDs of forms being rendered on the page into a static array (`$rendered_form_ids`).
    *   When `modify_elements_config` runs, it retrieves the *last* form ID from the `$rendered_form_ids` array (assuming the config filter runs shortly after the form is rendered).
    *   Fetches the saved `_ajl_style_*` settings for that form ID.
    *   Modifies the `appearance[variables]` and `appearance[rules]` keys of the `$config` array passed to the filter based on the saved settings.
    *   Returns the modified `$config` array.

2.  **Standard Field/Button Styling:**
    *   Also uses the `simpay_form_before_form_top` action hook to capture rendered form IDs.
    *   Hooks into `wp_print_footer_scripts` (a late-running action).
    *   The `print_late_frontend_styles` function iterates through the captured `$rendered_form_ids`.
    *   For each applicable form ID, it fetches the saved `_ajl_style_*` settings.
    *   It generates CSS rules targeting specific elements within the form (e.g., `#simpay-form-{id}.simpay-styled .simpay-label`, `#simpay-form-{id} .simpay-form-control input[type="text"]`).
    *   `!important` flags are used to increase the likelihood of overriding default WP Simple Pay or theme styles.
    *   The generated CSS is directly echoed within `<style>` tags in the footer. This was found to be necessary for compatibility with the WP Simple Pay preview page.

## File Structure

```
wp-simple-pay-styles/
├── wp-simple-pay-styles.php        # Main plugin file (bootstrap, checks)
├── includes/
│   ├── class-ajl-styler.php        # Main plugin orchestrator (singleton)
│   ├── class-ajl-settings.php      # Handles getting/saving style post meta
│   ├── class-ajl-admin-ui.php      # Builds the admin UI within WPSPay editor
│   └── class-ajl-frontend.php      # Handles frontend filtering and CSS/Elements config generation
├── assets/                         # Placeholder for future CSS/JS
│   ├── css/
│   └── js/
├── languages/                      # Placeholder for translations
└── README.md                       # This file
```

## Future Enhancements

*   Improve the admin UI layout (currently functional but basic).
*   Add more styling options (e.g., hover states for inputs, specific field types, error message styling).
*   Explore adding a simple live preview within the admin UI.
*   Add plugin settings page for global defaults or options.
*   Improve CSS selector robustness if WP Simple Pay HTML structure changes significantly.
*   Add internationalization (.pot file generation).

## Contributing

(Placeholder - Define contribution guidelines if this were an open-source project).

---
